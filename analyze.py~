
import pandas as pd
import numpy as np

import json

in_dir = 'data-2017-12-12'

df = pd.read_csv('./data/' + in_dir + '/info.csv')

nodes = sorted(list(set(df['origin_id'])))

turns = []
games = []

for i in range(len(df)):

    row = df.iloc[i]
    contents = json.JSONDecoder().decode(row['contents'])

    try:
        turns += [contents['turn']]
    except:
        pass

    try:
        games += [contents['set']]
    except:
        pass


for t in turns:

    for net in [2,3]:

for node in nodes:

    is_player = len(df[(df['origin_id'] == node) & (df['type'] == 'received_action')]) > 0

    if not is_player:
        continue
 
    row = df[(df['origin_id'] == node) & (df['type'] == 'received_action')]['contents']
    assert len(row) == 1
    received = json.JSONDecoder().decode(row.iloc[0])

    row = df[(df['origin_id'] == node) & (df['type'] == 'action')]['contents']
    assert len(row) == 1
    action = json.JSONDecoder().decode(row.iloc[0])

    if received['turn'] > 0:
        shown = np.array([0 for i in range(len(received['action']))], dtype = 'object')
    
        inds = np.array(received['action']) == 1
        shown[inds] = np.array(received['fails'][received['turn']-1])[inds]
    else:
        shown = [0 for i in range(len(action['action']))]

    print()
    print(list(shown))
    print(list(action['action']))

